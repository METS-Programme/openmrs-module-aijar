<htmlform formName="Patient Transfers"
          formDescription=""
          formUuid="45d9db68-e4b5-11e7-80c1-9a214cf093ae"
          formVersion="1.0"
          formAddMetadata="yes"
          formUILocation="patientDashboard.overallActions"
          formOrder="1"
          formIcon="icon-exchange"
          formShowIf="patient.person.dead==false"
          formDisplayStyle="Standard"
          formLabel="Patient Referral">
    <style>

        form label, .form label {
            float: left;
            padding: 0px 10px 0 0;
        }

        form input[type="checkbox"], form input[type="radio"], .form input[type="checkbox"], .form input[type="radio"] {
            margin: 10px 15px;
        }

        table td {
            background: #FFFFFF;
            color: #404040;
        }

        form select, .form select {
            min-width: 0px;
        }

        form input, form select, form textarea, form ul.select, .form input, .form select, .form textarea, .form
        ul.select {
            background-color: #FBFBFB;
            border: 1px solid #CEC9C9;
            border-radius: 5px;
            margin-bottom: 10px;
            padding: 10px;
            min-width: 20%;
        }

        .row {
            width: 100%;
            float: left;
            display: inline-flex;
            clear: both;
        }

        .results_style {
            font-weight: bold;
            color: #0808fd;
        }

        .row .row-col2 {
            float: left;
            width: 50%;
        }

        table th, table td {
            border: 1px solid #AFAFAF;
        }

        #br {
            white-space: pre;
        }

        input[type="checkbox"] {
            margin: 0px 2px;
        }

        .obs-field {

        }

        .div-col2 {
            display: table-cell;
            margin-right: auto;
            margin-left: auto;
            width: 20%;
        }
    </style>
    <script type="text/javascript">
        if (jQuery) {
            jq(document).ready(function () {

                var data1 = jq.ajax({
                    dataType: "json",
                    url: "http://localhost:8080/openmrs/ws/rest/v1/encounter?patient=990d60c5-1966-45b0-9222-3322f7a59317&amp;v=custom%3A(display%2Cobs%3A(concept%3A(conceptId)%2CvalueText%2CvalueNumeric%2CvalueDatetime%2CvalueCoded%3A(conceptId)))&amp;encounterType=8d5b27bc-c2cc-11de-8d13-0010c6dffd0f&amp;limit=1",
                    data: "",
                    success: "success"
                });

                var data2 = jq.ajax({
                    dataType: "json",
                    url: "http://localhost:8080/openmrs/ws/rest/v1/encounter?patient=990d60c5-1966-45b0-9222-3322f7a59317&amp;v=custom%3A(display%2Cobs%3A(concept%3A(conceptId)%2CvalueText%2CvalueNumeric%2CvalueDatetime%2CvalueCoded%3A(conceptId)))&amp;encounterType=8d5b2be0-c2cc-11de-8d13-0010c6dffd0ff&amp;limit=1",
                    data: "",
                    success: "success"
                });

                // Enable disable other outcomes
                jq('#encounter_type').change(function () {
                    enable_disable_show_hide('encounter_type', '99109', 'Transfer In');
                });

                jq('#encounter_type').each(function () {
                    enable_disable_show_hide('encounter_type', '99109', 'Transfer In');
                });

                jq('#encounter_type').change(function () {
                    enable_disable_show_hide('encounter_type', 'transfer_in', 'Transfer In');
                });

                jq('#encounter_type').each(function () {
                    enable_disable_show_hide('encounter_type', 'transfer_in', 'Transfer In');
                });

                jq('#encounter_type').change(function () {
                    enable_disable_show_hide('encounter_type', 'transfer_out', 'Transfer Out');
                });

                jq('#encounter_type').each(function () {
                    enable_disable_show_hide('encounter_type', 'transfer_out', 'Transfer Out');
                });

                // Enable disable other outcomes
                jq('#encounter_type').change(function () {
                    enable_disable_show_hide('encounter_type', '90211', 'Transfer Out');
                });

                jq('#encounter_type').each(function () {
                    enable_disable_show_hide('encounter_type', '90211', 'Transfer Out');
                });


                jq('#164993').change(function () {
                    enable_disable_show_hide('164993', 'comprehensive_transfer', 'ART Clinic');
                });

                jq('#164993').each(function () {
                    enable_disable_show_hide('164993', 'comprehensive_transfer', 'ART Clinic');
                });

                jq('#90216').change(function () {
                    enable_disable('90216', '90217', 'Tb Rx');
                });

                jq('#90216').each(function () {
                    enable_disable('90216', '90217', 'Tb Rx');
                });

                jq('#90041').change(function () {
                    enable_disable('90041', '5596', 'Yes');
                });

                jq('#90041').each(function () {
                    enable_disable('90041', '5596', 'Yes');
                });

                jq('#99061').change(function () {
                    enable_disable('99061', '99268', 'OTHER');
                });

                jq('#99061').each(function () {
                    enable_disable('99061', '99268', 'OTHER');
                });


                // trigger a change when the form loads
                jq("#viral-load-results-qualitative").change(function () {
                    viral_load_widget('viral-load-results-qualitative', 'viral-load-results-copies');
                });

                jq("#viral-load-results-qualitative").each(function () {
                    viral_load_widget('viral-load-results-qualitative', 'viral-load-results-copies');
                });

                // trigger a change when the form loads
                jq("#viral-load-results-qualitative_1").change(function () {
                    viral_load_widget('viral-load-results-qualitative_1', 'viral-load-results-copies_1');
                });

                jq("#viral-load-results-qualitative_1").each(function () {
                    viral_load_widget('viral-load-results-qualitative_1', 'viral-load-results-copies_1');
                });
            });

            function viral_load_widget(triger, enabledDisabledId) {
                /* Handle viral load results */
                jq("#" + enabledDisabledId).attr("disabled", true);
                jq("#" + triger).change(function () {
                    var viral_load_status = getValue(triger + ".value");
                    if (viral_load_status == 1301) {
                        /* Detected */
                        enableContainer("#" + enabledDisabledId);
                        setValue(enabledDisabledId + ".value", '');
                    }
                    if (viral_load_status == 1306) {
                        /* Not Detected */
                        disableContainer("#" + enabledDisabledId);
                        setValue(enabledDisabledId + ".value", 1);
                    }
                    if (viral_load_status == "" || viral_load_status == 1304) {
                        /* Sample Rejected and no data */
                        disableContainer("#" + enabledDisabledId);
                        setValue(enabledDisabledId + ".value", '');
                    }
                });
            }

            function enable_disable_show_hide(triggerId, enabledDisabledId, conditionValue) {
                if (jq("#" + triggerId + " :selected").text() === conditionValue) {
                    showContainer('#' + enabledDisabledId);
                } else if (jq('#' + triggerId).find('span').text() === conditionValue) {
                    showContainer('#' + enabledDisabledId);
                } else {
                    hideContainer('#' + enabledDisabledId);

                }
            }

            function enable_disable(triggerId, enabledDisabledId, conditionValue) {
                disableContainer('#'+enabledDisabledId);
                if (jq("#" + triggerId + " :selected").text() === conditionValue) {
                    enableContainer('#' + enabledDisabledId);
                } else if (jq('#' + triggerId).find('span').text() === conditionValue) {
                    enableContainer('#' + enabledDisabledId);
                } else {
                    disableContainer('#' + enabledDisabledId);
                }
            }

            function validateRequiredFieldsByValue(triggerId, validateFieldId, triggerValue, message_to_throw, validateFieldType) {
                var selected_value = jq("#" + triggerId).find(":selected").text().trim().toLowerCase();
                var validateFieldValue = "";

                if (validateFieldType === "input_text") {
                    validateFieldValue = jq("#" + validateFieldId).find("input:text").val();
                } else if (validateFieldType === "textarea") {
                    validateFieldValue = jq("#" + validateFieldId).find("textarea").value;
                }

                if (selected_value === triggerValue &amp;&amp; validateFieldValue === "") {
                    getField(validateFieldId + '.error').html(message_to_throw).show;
                    jq('#' + validateFieldId).find("span").removeAttr("style");

                    return false;
                }
                else {
                    return true;
                }
            }


            beforeSubmit.push(function () {
                var submitVal = true;
                var submitValStage = [];

                submitValStage.push(validateRequiredFieldsByValue("encounter_type", "99109", "transfer in", "required", "input_text"));
                submitValStage.push(validateRequiredFieldsByValue("encounter_type", "90211", "transfer out", "required", "input_text"));
                submitValStage.push(validateRequiredFieldsByValue("encounter_type", "99387_2", "transfer out", "required", "textarea"));
                // Check if there are no errors on the form
                if (submitValStage.indexOf(false) != -1) {
                    submitVal = false;
                    jq().toastmessage('showErrorToast', "There were errors during validation. Correct them and submit again");
                }

                return submitVal;
            });
        }
    </script>
    <div class="ai-page-frame">
        <div class="headers" style="text-align: center;">
            <h3 style="background: #94979A; padding: 10px;">Patient Transfer/Referral Form (Transfer in
                Transfer out)</h3>
        </div>
        <section>
            <table>
                <tbody>
                <tr>
                    <td>
                        <label>Referral Type:</label>
                        <br/>
                        <encounterType id="encounter_type"
                                       types="3e8354f7-31b3-4862-a52e-ff41a1ee60af,e305d98a-d6a2-45ba-ba2a-682b497ce27c"
                                       default="Select Referral Type" required="true"/>
                    </td>
                    <td>
                        Date:
                        <encounterDate required="true"/>
                        <span style="display: none;">
                                            <encounterLocation default="629d78e9-93e5-43b0-ad8a-48313fd99117"
                                                               order="629d78e9-93e5-43b0-ad8a-48313fd99117"/>
                                        </span>
                    </td>
                    <td>
                        <obs id="99109" conceptId="99109" labelText=" From Where"/>

                        <obs id="90211" conceptId="90211" labelText=" To Where"/>
                    </td>
                    <td hidden="hidden">
                        <label>Clinic Referred to:</label>
                        <br/>
                        <obs id="164993" conceptId="164993" answerConceptIds="90013,90014,165048,90018,165047,99610"
                             answerLabels="OPD Clinic,PED OPD Clinic,TB Clinic,IPD,ART Clinic,SMC Care"
                             defaultValue="165047"
                             required="true"/>
                    </td>
                </tr>

                </tbody>
            </table>
        </section>

        <div id="comprehensive_transfer">
            <div class="ai-page-frame" id="transfer_in">
                <div class="headers" style="text-align: center;">
                    <h3>Comprehensive HIV Care/ART Patient Referral/Transfer</h3>
                </div>
                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>Patient ART History</th>
                            <th>Baseline Lab (At Start of ART)</th>
                            <th>Baseline Clinic Status</th>
                        </tr>
                        <tr>
                            <td>
                        <span class="ArtCareEnableDisable1">
                            <obs id="99061" conceptId="99061"
                                 answerConceptIds="99005,99006,164979,99015,99016,99039,99040,164977,99041,99042,99884,99885,164978,163017,99143"
                                 answerLabels="AZT-3TC-NVP, AZT-3TC-EFV,AZT-3TC-DTG, D4T-3TC-NVP, D4T-3TC-EFV, TDF-3TC-NVP, TDF-3TC-EFV, TDF-3TC-DTG, TDF-FTC-NVP, TDF-FTC-EFV,ABC-3TC-NVP,ABC-3TC-EFV,ABC-3TC-DTG,ABC-3TC-LPV/r,OTHER"
                                 labelText="Baseline ART Regimen"/>
                                </span>
                                <span class="ArtCareEnableDisableChild1">
                                <obs id="99268" conceptId="99268" labelText="Others"/>
                            </span>

                                <p>
                                    <obs id="99161" conceptId="99161" labelText="ART Start Date:"/>
                                </p>
                            </td>
                            <td>
                                <div class="div-table">
                                    <div class="div-row">
                                        <div class="div-col2">
                                            <obsgroup groupingConceptId="165137">
                                                <obs id="viral-load-results-qualitative" conceptId="1305"
                                                     answerConceptIds="1301,1306,1304"
                                                     answerLabels="Detected,Not Detected, Sample Rejected"
                                                     labelText="Viral Load"/>

                                                <obs id="viral-load-results-copies" conceptId="856"
                                                     labelText="(copies/ml)"/>
                                            </obsgroup>

                                            <obs id="163028" conceptId="163028" labelText="HB"/>
                                        </div>
                                        <div class="div-col2">
                                            <obs id="99071" conceptId="99071" labelText="CD4"/>
                                            <obs id="99145" conceptId="99145" labelText="CD4 (%)"/>
                                            <obs id="163024" conceptId="163024" labelText="TLC"/>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="div-table">
                                    <div class="div-row">
                                        <div class="div-col2">
                                            <obs id="99069" conceptId="99069" labelText="Weight"/>

                                            <obs id="163025" conceptId="163025" labelText="Height (cm)"/>
                                        </div>
                                        <div class="div-col2">
                                            <obs id="163026" conceptId="163026" labelText="WHO Clinic Status"/>

                                            <obs id="163027" conceptId="163027" labelText="Functional Status"/>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>

                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>Current Regimen</th>
                            <th>Most Recent Lab: (Date done)</th>
                            <th>Current Clinic Status</th>
                        </tr>
                        <tr>
                            <td>
                        <span class="ArtCareEnableDisable2">
                            <obs id="90315" conceptId="90315"
                                 answerConceptIds="99015,99016,99005,99006,164979,99039,99040,99041,99042,164977,99884,99885,164978,163017,99143"
                                 answerLabels="d4T-3TC-NVP,d4T-3TC-EFV,AZT-3TC-NVP,AZT-3TC-EFV,AZT-3TC-DTG,TDF-3TC-NVP,TDF-3TC-EFV,TDF-FTC-NVP,TDF-FTC-EFV,TDF-3TC-DTG,ABC-3TC-NVP,ABC-3TC-EFV,ABC-3TC-DTG,ABC-3CT-LPV/r,Other"
                                 label="Current Regimen"/>
                                </span>
                                <span class="ArtCareEnableDisableChild2">
                                <obs id="99126" conceptId="99126" labelText="Others"/>
                            </span>

                                <p>
                                    <obs id="163030" conceptId="163030" labelText="Regimen Issued till"/>
                                </p>
                            </td>
                            <td>
                                <div class="div-table">
                                    <div class="div-row">
                                        <div class="div-col2">
                                            <obs id="viral-load-results-qualitative_1" conceptId="1305"
                                                 answerConceptIds="1301,1306,1304"
                                                 answerLabels="Detected,Not Detected, Sample Rejected"
                                                 labelText="Viral Load"/>

                                            <obs id="viral-load-results-copies_1" conceptId="856"
                                                 labelText="(copies/ml)"/>

                                            <obs id="21" conceptId="21" labelText="HB"/>

                                        </div>
                                        <div class="div-col2">
                                            <obs id="5497" conceptId="5497" labelText="CD4"/>

                                            <obs id="730" conceptId="730" labelText="CD4 (%)"/>

                                            <obs id="1021" conceptId="1021" labelText="TLC"/>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="div-row">
                                    <div class="div-col2">
                                        <obs id="5089" conceptId="5089" labelText="Weight"/>

                                        <obs id="5090" conceptId="5090" labelText="Height (cm)"/>
                                    </div>
                                    <div class="div-col2">
                                        <obs id="90203" conceptId="90203" labelText="WHO Clinic Status"/>

                                        <obs id="90235" conceptId="90235" labelText="Functional Status"/>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>

                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>TB Status</th>
                            <th>Other Opportunist Infections</th>
                            <th>Pregnancy Status</th>
                        </tr>
                        <tr>
                            <td rowspan="3">
                        <span class="DistrictTbRegEnableDisable1">
                                <obs id="90216" conceptId="90216" labelText="Tb Status"
                                     answerConceptIds="90079,90073,90078,90071"
                                     answerLabels="No signs,Suspect,Diagnosed with Tb,Tb Rx"/>
                            </span>
                                <span class="DistrictTbRegEnableDisableChild1">
                                <obs id="90217" conceptId="90217" labelText="TB Start Date:"/>
                            </span>
                            </td>

                            <td>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90132"
                                     answerLabel="Cough" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90133"
                                     answerLabel="DB" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90128"
                                     answerLabel="Dementia" style="checkbox"/>
                                <br/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90129"
                                     answerLabel="Enceph" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90131"
                                     answerLabel="Fever" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90138"
                                     answerLabel="GUD" style="checkbox"/>
                                <br/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90094"
                                     answerLabel="Headache" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90134"
                                     answerLabel="IRIS" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="123"
                                     answerLabel="Malaria" style="checkbox"/>
                                <br/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90127"
                                     answerLabel="Pneumonia" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90137"
                                     answerLabel="PID" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="999"
                                     answerLabel="RTI" style="checkbox"/>
                                <br/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90130"
                                     answerLabel="Thrush" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90136"
                                     answerLabel="UD" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90139"
                                     answerLabel="Ulcers" style="checkbox"/>
                                <br/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="106"
                                     answerLabel="URTI" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90135"
                                     answerLabel="Weight loss" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="90126"
                                     answerLabel="Zoster" style="checkbox"/>
                                <br/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="507"
                                     answerLabel="KS" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="90251" answerConceptId="1294"
                                     answerLabel="CCM" style="checkbox"/>
                            </td>
                            <td rowspan="3">
                                <excludeIf velocityTest="$patient.gender =='M' || $patient.age &lt; 9">
                                <span class="PregnantEnableDisable1">
                                    <obs id="90041" conceptId="90041" style="checkbox" answerConceptIds="1066,1065"
                                         answerLabels="Yes,No" labelText="Pregnant"/>
                                </span>
                                    <span class="PregnantEnableDisableChild1">
                                    <obs id="5596" conceptId="5596" labelText="EDD" allowFutureDates="true"/>
                                    <br/>
                                </span>
                                </excludeIf>
                            </td>
                        </tr>
                        <tr>
                            <th>Other Medication Dispensed</th>
                        </tr>
                        <tr>
                            <td style="width: 50%;">
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="931"
                                     answerLabels="Amitriptilline" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="265"
                                     answerLabel="Amoxicillin" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="779"
                                     answerLabel="Cetrizine" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="740"
                                     answerLabel="Ciprofloxacine" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="922"
                                     answerLabel="Cloxacillin" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="99266"
                                     answerLabel="Coartem" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="90171"
                                     answerLabel="Dapsone" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="95"
                                     answerLabel="Doxycycline" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="1108" answerLabel="EH"
                                     style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="272"
                                     answerLabel="Erythromycin" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="747"
                                     answerLabel="Fluconazole" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="912"
                                     answerLabel="Ibuprofen" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="926"
                                     answerLabel="Ketoconazole" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="244"
                                     answerLabel="Mebendazole" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="237"
                                     answerLabel="Metronidazole" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="461"
                                     answerLabel="Multivitamins" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="99054"
                                     answerLabel="Nutrition Support" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="919"
                                     answerLabel="Nystatin" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="89"
                                     answerLabel="Paracetamol" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="1194" answerLabel="RH"
                                     style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="99127" answerLabel="RHE"
                                     style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="768" answerLabel="RHZ"
                                     style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="1131"
                                     answerLabel="RHZE" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="99128"
                                     answerLabel="RHZES" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="916"
                                     answerLabel="Septrin" style="checkbox"/>
                                <obs class="checkbox-styling" conceptId="1193" answerConceptId="329"
                                     answerLabel="Vit B Complex" style="checkbox"/>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <div class="div-row">
                                    <div class="div-col2">
                                        <label>Any Drug Allergies</label>
                                        <obs id="142" conceptId="142" size="30" style="textarea" rows="5" cols="60"/>
                                    </div>
                                    <div class="div-col2">
                                        <label>Reasons For Transfer</label>
                                        <obs id="99387" conceptId="99387" size="30" style="textarea" rows="5"
                                             cols="60"/>
                                    </div>
                                </div>


                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>
            </div>


            <div class="ai-page-frame" id="transfer_out">
                <div class="headers" style="text-align: center;">
                    <h3>Comprehensive HIV Care/ART Patient Referral/Transfer</h3>
                </div>
                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>Patient ART History</th>
                            <th>Baseline Lab (At Start of ART)</th>
                            <th>Baseline Clinic Status</th>
                        </tr>
                        <tr>
                            <td>
                                <div style="width: 100%">
                                    <label>Regimen:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99061').valueCoded.name"/>
                                </div>
                                <div style="width: 100%">
                                    <label>Other Regimen:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99268').valueText"/>
                                </div>
                                <br/>

                                <div style="width: 100%">
                                    <label>Date started:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99161').valueDatetime"/>
                                </div>
                            </td>
                            <td>

                                <div style="width: 100%" class="lookup">
                                    <label>Viral Load:</label>
                                    <lookup class="results_style" expression="fn.latestObs('163029').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>HB:</label>
                                    <lookup class="results_style" expression="fn.latestObs('163028').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>CD4:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99071').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>CD4 (%):</label>
                                    <lookup class="results_style" expression="fn.latestObs('99145').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>TLC:</label>
                                    <lookup class="results_style" expression="fn.latestObs('163024').valueNumeric"/>
                                </div>
                            </td>
                            <td>
                                <div style="width: 100%">
                                    <label>Weight:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99069').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>Height:</label>
                                    <lookup class="results_style" expression="fn.latestObs('163025').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>WHO Clinic Status:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99070').valueCoded.name"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>Functional Status:</label>
                                    <lookup class="results_style" expression="fn.latestObs('163027').valueCoded.name"/>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>

                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>Current Regimen</th>
                            <th>Most Recent Lab(Date done)</th>
                            <th>Current Clinic Status</th>
                        </tr>
                        <tr>
                            <td>
                                <div style="width: 100%">
                                    <label>Regimen:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90315').valueCoded.name"/>
                                    <lookup class="results_style" expression="fn.latestObs('99126').valueText"/>
                                </div>
                                <div style="width: 100%">
                                    <label>Regimen Issued until:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90315').dateCreated"/>
                                    <lookup class="results_style" expression="fn.latestObs('99126').dateCreated"/>
                                </div>
                            </td>
                            <td>
                                <div style="width: 100%" class="lookup">
                                    <label>Viral Load:</label>
                                    <lookup class="results_style" expression="fn.latestObs('1305').valueCoded.name"/>
                                    <lookup class="results_style" expression="fn.latestObs('856').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>HB:</label>
                                    <lookup class="results_style" expression="fn.latestObs('21').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>CD4:</label>
                                    <lookup class="results_style" expression="fn.latestObs('5497').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>CD4 (%):</label>
                                    <lookup class="results_style" expression="fn.latestObs('730').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>TLC:</label>
                                    <lookup class="results_style" expression="fn.latestObs('1021').valueNumeric"/>
                                </div>
                            </td>
                            <td>

                                <div style="width: 100%">
                                    <label>Weight:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90236').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>Height:</label>
                                    <lookup class="results_style" expression="fn.latestObs('5090').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>WHO Clinic Status:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90203').valueCoded.name"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>Functional Status:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90235').valueCoded.name"/>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>

                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>TB Status</th>
                            <th>Other Opportunist Infections<br/> and Medications</th>
                            <th>Pregnancy Status</th>
                        </tr>
                        <tr>

                            <td>
                                <div style="width: 100%">
                                    <label>TB Status:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90216').valueCoded.name"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>TB Start Date:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90217').valueDatetime"/>
                                </div>
                                <br/>
                            </td>

                            <td>
                                <div style="width: 100%">
                                    <label>Other Opportunist Infections:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90251').valueCoded.name"/>
                                    <lookup class="results_style" expression="fn.latestObs('99032').valueText"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>Other Medications:</label>
                                    <lookup class="results_style" expression="fn.latestObs('1193').valueCoded.name"/>
                                    <lookup class="results_style" expression="fn.latestObs('99035').valueText"/>
                                </div>
                            </td>
                            <td>
                                <excludeIf velocityTest="$patient.gender =='M' || $patient.age &lt; 9">
                                    <div style="width: 100%">
                                        <label>Pregnant:</label>
                                        <lookup class="results_style"
                                                expression="fn.latestObs('90041').valueCoded.name"/>
                                    </div>

                                    <div style="width: 100%">
                                        <label>EDD:</label>
                                        <lookup class="results_style" expression="fn.latestObs('5596').valueDatetime"/>
                                        <br/>
                                    </div>
                                </excludeIf>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <label>Any Drug Allergies</label>
                                <div style="width: 100%">
                                    <label>Other Medications:</label>
                                    <lookup class="results_style"
                                            complexExpression="#foreach($allergy in $fn.allObs(142)) $allergy.valueText #end"/>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <label>Reasons For Transfer</label>
                                <obs id="99387_2" class="text-box-styling" conceptId="99387" size="30" style="textarea"
                                     rows="5"
                                     cols="80"/>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>
            </div>
        </div>
        <br/>
        <submit submitLabel="Save"/>
    </div>
</htmlform>