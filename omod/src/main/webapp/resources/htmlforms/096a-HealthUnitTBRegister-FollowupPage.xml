<?xml version="1.0" encoding="utf-8"?>
<htmlform formName="Form 096a - Health Unit TB Register - Follow up"
          formDescription="HMIS Form 096a - Health Unit TB Register - Follow up"
          formEncounterType="334bf97e-28e2-4a27-8727-a5ce31c7cd66"
          formUuid="b609b3f0-6fa8-4764-976e-625f0683b690"
          formVersion="1.0"
          formAddMetadata="yes"
          formUILocation="patientDashboard.visitActions"
          formOrder="2"
          formIcon="icon-medkit"
          formShowIf="(visit.active || !visit.active) &amp;&amp; patient.person.dead==false &amp;&amp; sessionLocation.uuid=='8ab22b55-9a17-4121-bf08-6134a9a2439f'"
          formDisplayStyle="Standard"
          formLabel="Form 096a - Health Unit TB Register - Summary">
	<script type="text/javascript">
		/*
		Transfer in Unit-TB Number	Only applicable if Transfer In - done - 
		CPT Start Date	Required/Enabled if patient is on CPT -done
		ART Start Date	Required/Enabled if patient is on ART -done -
		ART Number	Required/Enabled if patient is on ART -done-
		No of children in contact	should always be greater than no of children on IPT -done-
		INR No.	should only be enabled/Reqired if MUAC Colour Code is red or yellow -done
		Transfer out to	Required/Enabled if treatment outcome is 'transfer out' -done -
		MUAC/z-score section	applicable for clients aged 6months and above and below 15 years -done -
		*/
		
		if (jQuery) {
			jq(document).ready(function () {
				if (jq.browser.msie) {
					jq(":checkbox").click(function () {
						jq(this).change();
					});
				}
			});
		}
		
		JQuery().ready(function(jq){
			var common = {
				disableField: function(args) {
					if (args instanceof jQuery) {
						args.attr('disabled', true);
					} else if (args typeof args === 'string' ){
						jq(args).attr('disabled', true);        		
					}
				},
				enableField: function(args) {
					if (args instanceof jQuery) {
						args.removeattr('disabled');
					} else if (args typeof args === 'string' ){
						jq(args).removeattr('disabled');        		
					}
				},
				makeReadonly: function(args) {
					if (args instanceof jQuery) {
						args.attr('readonly', true).fadeTo(250, 0.5);
					} else if (args typeof args === 'string' ){
						jq(args).attr('readonly', true).fadeTo(250, 0.5);        		
					}
				},
				removeReadOnly: function(args) {
					if (args instanceof jQuery) {
						args.removeattr('readonly').fadeTo(250, 1);
					} else if (args typeof args === 'string' ){
						jq(args).removeattr('readonly').fadeTo(250, 1);        		
					}
				}
			};
		
			const YES_CONCEPT_ID = 1065;
			const NO_CONCEPT_ID = 1066;
			const RED_CONCEPT_ID = 99028;
			const YELLOW_CONCEPT_ID = 99029;
			const TRANSFER_OUT_CONCEPT_ID = 90306;
		
			const TRANSFER_IN_FROM_FIELD = ''
		
			var $muacColorCodeField = jq('#muac-color-code').find('input');
			var $inrNumberField = jq('#inr-number').find('input');
			var $muacSection = ('#muac');
		
			var muacColorCodeChange = function() {
				var muacColorCodeValue = getValue('muac-color-code.value');
				if (muacColorCodeValue == YELLOW_CONCEPT_ID || muacColorCodeValue == RED_CONCEPT_ID) {
					common.enableField($inrNumberField);
				} else {
					common.disableField($inrNumberField);
				}		
			};
		
			$muacColorCodeField.change(muacColorCodeChange());
		
			muacColorCodeChange();
		
			beforeSubmit.push(function(){
				var valid = true;
				if (onCptValidate()) {
					valid = true;
				} else {
					valid = false;
				}
		
				if (onArtValidate()) {
					valid = true;
				} else {
					valid = false;
				}
		
				if (noOfChildrenValidate()) {
					valid = true;
				} else {
					valid = false;
				}
		
				if (transferOutValidate()) {
					valid = true;
				} else {
					valid = false;
				}
		
				if (noOfChildrenValidate()) {
					valid = true;
				} else {
					valid = false;
				}
		
				return valid;
			});
		
		});	
	
	</script>

  <div class="ai-page-frame">
    <div class="headers" style="text-align: center;">
      <h3 style="background: #FFFF7D; padding: 10px;">096a - Health Unit TB Register - Follow up Page</h3>
    </div>
    <section>
      <table>
        <tbody>
          <tr>
            <td>
              <span style="display: none;">
                <encounterLocation default="8ab22b55-9a17-4121-bf08-6134a9a2439f"
                                   order="8ab22b55-9a17-4121-bf08-6134a9a2439f"/>
              </span>
            </td>
            <td>
              <label>
                <span class="required">*</span> Provider:
              </label>
              <encounterProvider role="Provider" style="autocomplete" required="required"/>
            </td>
          </tr>

        </tbody>
      </table>
    </section>
    <fieldset>
      <legend>Results of sputum and other examinations</legend>
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td >
            <p>
            	<label>Follow up visit date:</label>
              <encounterDate default="today" disallowMultipleEncountersOnDate="block"/>
            </p>
          </td>
          <td ></td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>
            <p>
            <label>Sputum smear results</label>
              <obs conceptId="307" answerConceptIds="1118,664,1362,1363,1364,1365,163417AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,163418AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="ND - Not Done, NEG- Negative, 1AFB/100, 2AFB/100, 3AFB/100, 4AFB/100,5AFB/100,6AFB/100" style="dropdown" answerSeparator="&lt;br/&gt;"/>
              Missing (7AFB/100,8AFB/100,9AFB/100)
            </p>
          </td>
          <td >
            <p>
            <label>Examination Date</label>
              <obs conceptId="99392" />
            </p>
          </td>
          <td >
            <p>
            <label>DST Results</label>
              <obs conceptId="159984AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="dropdown"/>
              Missing Responses
            </p>
          </td>
          <td >
            <p>
            <label>Date of DST results</label> Missing
            </p>
          </td>
        </tr>
      </table>
    </fieldset>

    <fieldset>
      <legend>MUAC/z-score</legend>
      <table width="100%" border="0" cellspacing="0" cellpadding="0" id="muac">
        <tr>
          <td colspan="2" valign="top" >
            <p>
              <label>Weight for age z-score</label> 
              <obs conceptId="1854AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="115,99271,99272" answerLabels="N-Normal,MAM-Moderate Acute Mulnutrition,SAM-Severe Acute Mulnutrition" style="radio" answerSeparator="&lt;br/&gt;" />
            </p>
          </td>
          <td colspan="2" valign="top" >
            <p>
              <label>Height/Length for age z-score</label>
              <obs conceptId="164088" answerConceptIds="1115,164085" answerLabels="N-Normal,S-Stunting" />
            </p>
          </td>
          <td valign="top">
            <p>
              <label>MUAC Colour Code</label>
              <obs conceptId="99030" style="radio" answerConceptIds="99028,99027,99029" id="muac-color-code" />
            </p>
          </td>
          <td valign="top" >
            <p><label>INR No</label>
              <span id="inr-number">
                <patient  field="identifier" identifierTypeId="d4b21726-e908-4b1a-abab-b5f87cd01c18" id="inr-no" required="true" />
              </span>
            </p>
          </td>
        </tr>
      </table>
    </fieldset>

    <fieldset>
      <legend>Issue of  anti-TB drug (Missing grouping concept)</legend>
      <table width="100%" border="0" cellspacing="0" cellpadding="0" style="width:100%" id="tb-drugs">
        <tr>
          <th >  TB Treatment phase    </th>
          <th >
            <p><label>Name of drug</label></p>
          </th>
          <th >
            <p><label>Date Dispensed</label></p>
          </th>
          <th >
            <p><label>No. of days for which Treatment is dispensed</label> </p>
          </th>

          <th align="center"></th>
        </tr>

        <repeat>
          <template>
            <obsgroup groupingConceptId="163711AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
            <tr>
              <td >
                <p>
                  <obs conceptId="159792" answerConceptSetIds="159794,159795" answerLabels="Initial, Retreatment" id="{id}" style="radio"/>
                </p>
              </td>
              <td ></td>
              <td ></td>

              <td ></td>
              <td align="center">
                <a href="#" style="text-decoration:none;">+ Add</a>
              </td>
            </tr>
			</obsgroup>
          </template>
		  <render id="1"/>
        </repeat>
      </table>
    </fieldset>
    <submit/>
  </div>
</htmlform>