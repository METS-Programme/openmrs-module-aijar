<htmlform formName="HMIS 096A Health Unit TB Form"
          formDescription="HMIS 096A Health Unit TB Form"
          formEncounterType="334bf97e-28e2-4a27-8727-a5ce31c7cd66"
          formUuid="ec912f1c-dd2f-4e88-9f76-4f9f692fac2b"
          formVersion="1.0"
          formAddMetadata="yes"
          formUILocation="patientDashboard.visitActions"
          formOrder="1"
          formIcon="icon-medkit"
          formShowIf="(visit.active || !visit.active) &amp;&amp; patient.person.dead==false &amp;&amp; sessionLocation.uuid=='8ab22b55-9a17-4121-bf08-6134a9a2439f'"
          formDisplayStyle="Standard"
          formLabel="HMIS 096A Health Unit TB Form">

	<style type="text/css">
		form#htmlform div.ai-page-frame table>tbody tr:nth-child(odd) td {
			background: #eeeeee;
		}

		form#htmlform div.ai-page-frame table>tbody tr:nth-child(even) td {
			background: #f9f9f9;
		}

		form#htmlform div.ai-page-frame fieldset#child-information table {
			margin: 0 0 5px 0;
		}	

	  	table.multi td, table.multi th {
			width: 20% !important;
			border: 1px solid rgb(199, 199, 199) !important;
		}

		table.multi td.duration input {
			min-width: 20% !important;
			width: 25px !important;
			margin-right: 5px;
		}

		table.multi td.duration select {
			min-width: 20% !important;
			width: 50% !important;
			clear: none !important;
		}

	    .inError {
	        border: 2px dotted #ff0000 !important;
	    }

		form#htmlform div.ai-page-frame table>tbody tr:nth-child(odd) td {
			background: #eeeeee;
		}

		form#htmlform div.ai-page-frame table>tbody tr:nth-child(even) td {
			background: #f9f9f9;
		}

		#encounter input {
			min-width: 20% !important;
			width: 20% !important;
		}

	</style>

	<script type="text/javascript">
		if (jQuery) {
			jQuery(document).ready(function (jq) {
				if (jq.browser.msie) {
					jq(":checkbox").click(function () {
						jq(this).change();
					});
				}
			});
		}
		
		jQuery().ready(function(jq) {
			const YES_CONCEPT_ID = 1065,
				NO_CONCEPT_ID = 1066,
				RED_CONCEPT_ID = 99028,
				YELLOW_CONCEPT_ID = 99029,
				TRANSFER_OUT_CONCEPT_ID = 90306,
				OTHER_CONCEPT_ID = 5622,
				COUNSELLING_DONE_CONCEPT_ID = 99405,
				COUNSELLING_AND_TESTING_DONE_CONCEPT_ID = 99406,
				COUNSELLING_AND_TESTING_DONE_HIV_POS_CONCEPT_ID = 99407,
				COUNSELLING_AND_TESTING_DONE_HIV_NEG_CONCEPT_ID = 99408;
				PBC_CONCEPT_ID = 113491;
	        	HIV_STATUS_CONCEPT_ID = 90253;
	        	HIV_POSITIVE_CONCEPT_ID = 90166;
	        	HIV_NEGATIVE_CONCEPT_ID = 90167,
	        	NOT_DONE_CONCEPT_ID = 1118,
				INTENSIVE_CONCEPT_ID = 159794,
				CONTINOUS_CONCEPT_ID = 159795,
				RHZE_CONCEPT_ID = 1675,
				RHZ_CONCEPT_ID = 1678;

			var $transferInFromField,
				$transferInUnitTbNumberField,
				$unitTbNoField,
				$onCptField,
				$cptStartDateField,
				$onArtField,
				$artStartDateField,
				$artNumberField,
				$muacColorCodeField,
				$inrNumberField,
				$treatmentOutcomeField,
				$transferOutToField,
				$noOfChildrenInContactField,
				$noOfChildrenInContactOnIptField,
				$healthWorkerField,
				$cadreOfHealthWorkerField,
				$hivCounsellingAndTestingField,
				$hivTestingDateField,
				$patientReceivedResultsField,
				$muacSection,
				$tbHivActivitiesSection,
				$sputumSmearResultsField,
				$sputumSmearResultsDateField,
				$dstResultsField,
				$dstResultsDateField,
				$encounterDateField,
				patientAge;
		
			$transferInFromField = getField('transfer-in-from.value');
			$transferInUnitTbNumberField = jq('#transfer-in-unit-tb-no').find('input[type="text"]');
			$unitTbNoField = jq('span#unit-tb-no').find('input[type="text"]');
			$onCptField = jq('#on-cpt').find('input');
			$cptStartDateField = getField('cpt-start-date.value');
			$onArtField = jq('#on-art').find('input');
			$artStartDateField = getField('art-start-date.value');
			$artNumberField = getField('art-number.value');
			$muacColorCodeField = jq('#muac-color-code').find('input');
			$inrNumberField = jq('#inr-number').find('input');
			$treatmentOutcomeField = getField('treatment-outcome.value');
			$transferOutToField = getField('transfer-out-to.value');
			$noOfChildrenInContactField = getField('no-of-children-in-contact.value');
			$noOfChildrenInContactOnIptField = getField('no-of-children-in-contact-on-ipt.value');
			$healthWorkerField = jq('#health-worker').find('input');
			$cadreOfHealthWorkerField = getField('cadre-of-health-worker.value');
			$hivCounsellingAndTestingField = getField('hiv-counselling-and-testing.value');
			$hivTestingDateField = getField('hiv-testing-date.value');
			$sputumSmearResultsField = jq('span.sputum-smear-results').find('select');
			$sputumSmearResultsDateField = jq('span.sputum-smear-results-date').find('input');
			$dstResultsField = jq('span.dst-results').find('select');
			$dstResultsDateField = jq('span.dst-results-date').find('input');
			$diseaseClassificationField = getField('disease-classification.value');
			$patientReceivedResultsField = jq('#patient-received-hiv-results').find('input');
			$patientHivTestResults = jq('#patient-hiv-results').find('input');
	        $encounterDateField = jq('#encounter-date').find('input[type="hidden"]');

			$muacSection = jq('#muac');
			$tbHivActivitiesSection = jq('#tb-hiv-activities');
			patientAge = <lookup expression="patient.age" />;
		
			var transferInFromChange = function() {
				var transferInFromValue = getValue('transfer-in-from.value');
				if (transferInFromValue == '') {
					$transferInUnitTbNumberField.val('');					
					fieldHelper.disable($transferInUnitTbNumberField);
				} else {
					fieldHelper.enable($transferInUnitTbNumberField);
					$transferInUnitTbNumberField.focus();
				}
			};  
			
			var onCptChange = function() {
				var onCptValue = getValue('on-cpt.value');
				if (onCptValue == YES_CONCEPT_ID) {
					fieldHelper.enable($cptStartDateField);
				} else {
					fieldHelper.disable($cptStartDateField);
				}
			};  
		
			var onArtChange = function() {
				var onArtValue = getValue('on-art.value');
				if (onArtValue == YES_CONCEPT_ID) {
					fieldHelper.enable($artStartDateField);
					fieldHelper.enable($artNumberField);
				} else {
					fieldHelper.disable($artStartDateField);
					fieldHelper.disable($artNumberField);
				}
			};
		
			var muacColorCodeChange = function() {
				var muacColorCodeValue = getValue('muac-color-code.value');
				if (muacColorCodeValue == YELLOW_CONCEPT_ID || muacColorCodeValue == RED_CONCEPT_ID) {
					fieldHelper.enable($inrNumberField);
				} else {
					fieldHelper.disable($inrNumberField);
				}		
			};
		
			var treatmentOutcomeChange = function() {
				var treatmentOutcomeValue = getValue('treatment-outcome.value');
				if (treatmentOutcomeValue == TRANSFER_OUT_CONCEPT_ID) {
					fieldHelper.enable($transferOutToField);
				} else {
					fieldHelper.disable($transferOutToField);
				}		
			};
		
			var noOfChildrenInContactChange = function() {
				var noOfChildrenInContactValue,
					noOfChildrenInContactOnIptValue;

				noOfChildrenInContactValue = getValue('no-of-children-in-contact.value');
				noOfChildrenInContactOnIptValue = getValue('no-of-children-in-contact-on-ipt.value');
				if (parseInt(noOfChildrenInContactValue) &lt; parseInt(noOfChildrenInContactOnIptValue)) {
					getField('no-of-children-in-contact-on-ipt.error').html('"Number of children in contact" cannot be less than "Number of children in contact and on IPT"').show();
					getField('no-of-children-in-contact.error').html('"Number of children in contact" cannot be less than "Number of children in contact and on IPT"').show();
				} else {
					getField('no-of-children-in-contact-on-ipt.error').html('').hide();
					getField('no-of-children-in-contact.error').html('').hide();
				} 				
			};

			var healthWorkerChange = function() {
				var isHealthWorker = getValue('health-worker.value');
				if (isHealthWorker == YES_CONCEPT_ID) {
					fieldHelper.enable($cadreOfHealthWorkerField);
				} else {
					$cadreOfHealthWorkerField.val('');
					$cadreOfHealthWorkerField.change()
					fieldHelper.disable($cadreOfHealthWorkerField);
				}
			};

			var enableFieldsInContainer = function ($container, exemptions) {
				$container.each(function() {
					if (exemptions.indexOf(jq(this).attr('id')) == -1) {
						fieldHelper.enable(jq(this));
					} else {
						fieldHelper.disable(jq(this));

						if (jq(this).is('input[type="text"], select')) { //Clear values Entered and/or Selected in the disabled fields
							jq(this).val('');
							jq(this).change();
						} else if (jq(this).is('input[type="radio"]') || jq(this).is('input[type="checkbox"]')) {
							jq(this).attr('checked', false);
						}						
					}
				});
			};

			var disableFieldsInContainer = function ($container, exemptions) {
				$container.find('input[type="radio"], input[type="text"], input[type="checkbox"], select').each(function() {
					if (exemptions.indexOf(jq(this).attr('id')) == -1) {
						fieldHelper.disable(jq(this));

						if (jq(this).is('input[type="text"], select')) { //Clear values Entered and/or Selected in the disabled fields
							//jq(this).val('');
							jq(this).change();
						} else if (jq(this).is('input[type="radio"]') || jq(this).is('input[type="checkbox"]')) {
							jq(this).attr('checked', false);
						}
					} else {
						fieldHelper.enable(jq(this));
					}
				});
			};

		    var hideCounsellinAndTestingOptionsForHivPositivePerson = function() {
				var counsellingTestingOptionsToHide = [99405,99406,99408];
				var optionsToHide =  $hivCounsellingAndTestingField.children('option').filter(function() {
					return counsellingTestingOptionsToHide.indexOf(parseInt(this.value)) &gt; -1;
				});
				optionsToHide.attr('disabled', true);
		    };

		    var hideCounsellinAndTestingOptionsForHivNegativePerson = function() {
				var counsellingTestingOptionsToHide = [];
				var optionsToHide =  $hivCounsellingAndTestingField.children('option').filter(function() {
					return counsellingTestingOptionsToHide.indexOf(parseInt(this.value)) &gt; -1;
				});
				optionsToHide.attr('disabled', true);
		    };

		    var getHivStatus = function () {
		    	/**
		    	* HIV Status field should be selected if patient is HIV +ve 
		    	*/
				var hivStatus = <lookup complexExpression="#set ($hivStatus = $fn.earliestObs(90253).valueCoded.conceptId)
															#if ($hivStatus) $hivStatus;
															#else '';
															#end" />

				var visitDate = $encounterDateField.val();
				var artSummaryEncounterDate = <lookup complexExpression="#set ($artSummaryEncounterDate = $fn.latestEncounter('8d5b27bc-c2cc-11de-8d13-0010c6dffd0f').encounterDatetime)
																		#if ($artSummaryEncounterDate) '$artSummaryEncounterDate';
																		#else '';
																		#end"/>
				if ((artSummaryEncounterDate !='' &amp;&amp; artSummaryEncounterDate &lt; visitDate) || hivStatus == HIV_POSITIVE_CONCEPT_ID) {
					hideCounsellinAndTestingOptionsForHivPositivePerson();
				} else {
					hideCounsellinAndTestingOptionsForHivNegativePerson();
				}
		    };

			var hivCounsellingAndTestingChange = function() {
				var $fieldsToDisable,
					$fieldsToEnable,
					$fieldsToExempt,
					fieldIdsToExempt;

				var hivCounsellingAndTestingValue = getValue('hiv-counselling-and-testing.value');

				fieldIdsToExempt = [];
				
				if (hivCounsellingAndTestingValue == COUNSELLING_DONE_CONCEPT_ID || hivCounsellingAndTestingValue == '') {
					fieldIdsToExempt.push($hivCounsellingAndTestingField.attr('id'));
					disableFieldsInContainer($tbHivActivitiesSection, fieldIdsToExempt);

				} else if (hivCounsellingAndTestingValue == COUNSELLING_AND_TESTING_DONE_CONCEPT_ID || hivCounsellingAndTestingValue == COUNSELLING_AND_TESTING_DONE_HIV_POS_CONCEPT_ID) {
					fieldIdsToExempt.push($hivCounsellingAndTestingField.attr('id'));
					fieldIdsToExempt.push($hivTestingDateField.attr('id'));
					$patientReceivedResultsField.each(function() { //Push IDs for radio buttons to the exemption array
						fieldIdsToExempt.push(jq(this).attr('id'));
					});
					$onCptField.each(function() {
						fieldIdsToExempt.push(jq(this).attr('id'));
					});
					$onArtField.each(function() {
						fieldIdsToExempt.push(jq(this).attr('id'));
					});
					disableFieldsInContainer($tbHivActivitiesSection, fieldIdsToExempt);

				} else if (hivCounsellingAndTestingValue == COUNSELLING_AND_TESTING_DONE_HIV_NEG_CONCEPT_ID) {
					fieldIdsToExempt.push($hivCounsellingAndTestingField.attr('id'));
					fieldIdsToExempt.push($hivTestingDateField.attr('id'));
					$patientReceivedResultsField.each(function() { //Push IDs for radio buttons to the exemption array
						fieldIdsToExempt.push(jq(this).attr('id'));
					});
					$onCptField.each(function() {
						fieldIdsToExempt.push(jq(this).attr('id'));
					});
					disableFieldsInContainer($tbHivActivitiesSection, fieldIdsToExempt);	

				}
				else {
					disableFieldsInContainer($tbHivActivitiesSection, fieldIdsToExempt);
				}
			};
		
			var patientReceivedHivResultsChange = function() {
				var patientReceivedHivResults = getValue('patient-received-hiv-results.value');

				if (patientReceivedHivResults == YES_CONCEPT_ID) {
					fieldHelper.enable($patientHivTestResults);
				} else {
					fieldHelper.disable($patientHivTestResults);				
				}
			}

			var childrenSectionToggle = function() {
				if (patientAge &gt; 6 &amp; patientAge &lt;= 180) {
					fieldHelper.enable($muacSection.find('input,select'));
				} else {
					fieldHelper.disable($muacSection.find('input,select'));
				}
		
			};
		
			var noOfChildrenValidate = function() {
				var noOfChildrenInContactValue,
					noOfChildrenInContactOnIptValue;

				noOfChildrenInContactValue = getField('no-of-children-in-contact.value');
				noOfChildrenInContactOnIptValue = getField('no-of-children-in-contact-on-ipt.value');
				if (noOfChildrenInContactValue &lt; noOfChildrenInContactOnIptValue) {
					getField('no-of-children-in-contact.error').html('"Number of children in contact" cannot be less than "Number of children in contact and on IPT"').show();
					return false;
				} else {
					return true;
				} 
			};
		
			var onCptValidate = function() {
				if (getValue('on-cpt.value') == YES_CONCEPT_ID &amp;&amp; getValue('cpt-start-date'.value) == '') {
					getField('cpt-start-date.error').html('CPT start date is required');
					return false;
				} else {
					return true;
				}
			};
		
			var onArtValidate = function() {
				if (getValue('on-art.value') == YES_CONCEPT_ID &amp;&amp; getValue('art-start-date'.value) == '') {
					getField('art-start-date.error').html('ART start date is required');
					return false;
				} else {
					return true;
				}
			};
		
			var transferOutValidate = function() {
				if (getValue('treatment-outcome.value') == TRANSFER_OUT_CONCEPT_ID &amp;&amp; getValue('transfer-out-to'.value) == '') {
					getField('transfer-out-to.error').html('The Transfer out to Unit required');
					return false;
				} else {
					return true;
				}
			};

			var tbUnitNumbersValidate = function() {
				$transferInUnitTbNo = $transferInUnitTbNumberField.val();
				$unitTbNo = $unitTbNoField.val();

				if (($transferInUnitTbNo != '' &amp;&amp; $unitTbNo != '') &amp;&amp; $transferInUnitTbNo == $unitTbNo) {
					return false;
				} else {
					return true;
				}
			}
			
			var diseaseClassificationChange = function() {
				if ($diseaseClassificationField.val() == PBC_CONCEPT_ID) {
					fieldHelper.enable($sputumSmearResultsField);
					fieldHelper.enable($sputumSmearResultsDateField);
				} else {
					fieldHelper.disable($sputumSmearResultsField);
					fieldHelper.disable($sputumSmearResultsDateField);
					fieldHelper.clear($sputumSmearResultsField);
					fieldHelper.clear($sputumSmearResultsDateField);
				}
			};
			
			/*
			* Pretty ugly function to move the obs Comment field for the X-Ray Results obs close to the 'Other' checkbox	
			*/
			var moveXRayCommentField = function() {
				var $xRayOtherField = jq('#other-xray').siblings('input[type=checkbox]');
				var $xRayCommentField = jq('#other-xray-comment').siblings('input[type=text]').filter(function() {
					return jq(this).is('.hasDatepicker') == false;	
				});

				$xRayOtherField.parent().append($xRayCommentField);
			};

	        var $othersField = jq('span.has-comment input[type=checkbox], span.has-comment select');

	        var toggleOtherSpecify = function() {
	            $othersField.each(function() {
	                var $specifyField,
	                	$thisField;

	                $specifyField = jq(this).siblings('input[type=text]');
	                $thisField = jq(this);
	                
	                if (($thisField.is('input[type=checkbox]') &amp; $thisField.attr('checked') == 'checked') || 
	                ($thisField.is('select') &amp; $thisField.val() == OTHER_CONCEPT_ID)) { 
	                    fieldHelper.removeReadonly($specifyField);
	                } else {
	                    fieldHelper.makeReadonly($specifyField);
	                    fieldHelper.clear($specifyField);
	                }
	            });
	        };

			/**
			* This validation check works this way:
			* For each visible row, If any text box or combo box is non-empty, check if there's any other text box or combobox within the same row that is empty. 
			* If so, validation fails and the elements with missing values are highlighted 
			*/
			var multipleEntryValidated = function () {
			    var $rows,
			        $objectsToValidate;
			    var dirty = false;
				
				$tables = jq('table.multi');

				$tables.each(function() {
					var $table = jq(this);
					if ($table.is('.novalidate') == false) { //Don't validate tables marked with the 'novalidate' css class
					    $rows = $table.find('&gt;tbody tr:visible');
					    $rows.each(function () {
					        $objectsToValidate = jq(this).find('input,select'); //Get all text and combo boxes
					        $objectsToValidate.removeClass('inError');
					        $objectsToValidate.each(function () {
					            $obj = jq(this);
					            if ($obj.val() !== '') { //Only run the validatiion check if there's at least one element that is non-empty 
					                $objectsToValidate.each(function () {
					                    if (jq(this).val() === '') {
					                        jq(this).addClass('inError');
					                        jq(this).siblings('span.error').html('Required').show()
					                        dirty = true;
					                    } else {
					                    	jq(this).siblings('span.error').html('').hide();
					                    }
					                });
					            }
					        });
					    });
					}					
				});

			    return !dirty;
			}
		
			$transferInFromField.change(transferInFromChange);
			$onCptField.change(onCptChange);
			$onArtField.change(onArtChange);
			$muacColorCodeField.change(muacColorCodeChange);
			$treatmentOutcomeField.change(treatmentOutcomeChange);
			$noOfChildrenInContactField.blur(noOfChildrenInContactChange);
			$noOfChildrenInContactOnIptField.blur(noOfChildrenInContactChange);
			$healthWorkerField.change(healthWorkerChange);
			$hivCounsellingAndTestingField.change(hivCounsellingAndTestingChange);
			$diseaseClassificationField.change(diseaseClassificationChange);
			$patientReceivedResultsField.change(patientReceivedHivResultsChange);
			$othersField.change(toggleOtherSpecify);

			var disableSelectOption = function($selectField, ids) {
				if (jQuery.isArray(ids)) {
					$selectField.children('option').each(function() {
						this.disabled = false;
						if (ids.indexOf(parseInt(this.value))) {
							this.disabled = 'disabled';
						}
					});
				}
			}

			transferInFromChange();
			onCptChange();
			muacColorCodeChange();
			treatmentOutcomeChange();
			healthWorkerChange();
			childrenSectionToggle();
			hivCounsellingAndTestingChange();
			onArtChange();
			diseaseClassificationChange();
			getHivStatus();
			moveXRayCommentField();
			patientReceivedHivResultsChange();
			toggleOtherSpecify();
		
			beforeSubmit.push(function(){
				var valid = true;
	            var $errorMessageSpan = jq('span#error-message');

				if (!onCptValidate()) {
					valid = false;
				}
		
				if (!onArtValidate()) {
					valid = false;
				}
		
				if (!noOfChildrenValidate()) {
					valid = false;
				}
		
				if (!transferOutValidate()) {
					valid = false;
				}
		
				if (!noOfChildrenValidate()) {
					valid = false;
				}

				if (!tbUnitNumbersValidate()) {
					valid = false;
				}

				//if (!sputumSmearResultsValidate()) {
				//	valid = false;
				//}

	            if (!multipleEntryValidated()) {
					valid = false;
	            }

				//Clear validation messages displayed during a previously failed validation check
				jq("span.error:visible:contains('Required'), span.error:visible:contains('Date without value')").html('').hide();
 	

	            if (jq('span.error.field-error:visible').length &gt; 0) {
	            	valid = false;
	            }

	            if (valid) {
	            	$errorMessageSpan.hide();
	            } else {
	            	$errorMessageSpan.show();
	            	jq().toastmessage('showErrorToast', "Form Validation failed. Check for errors");
	            }
		
				return valid;
			});
		
		});	

		jQuery(document).ready(function(jq) {
			//Adding new form
			var $allTables,
				$allRows,
				$otherRows,
				$firstRow,
				$thisRow,
				$nextRow,
				$hiddenRows,
				$lastVisibleRow,
				$nonEmptyBoxes;
	
			var showAddButtonForLastVisibleRow = function($container) {
				$lastVisibleRow = $container.find('tr:visible:last');
				$lastVisibleRow.find('.add').show();
			};
				
			$firstRow = jq('table.multi tbody tr:first-of-type');
			$otherRows = jq('table.multi tbody tr:not(:first-of-type)');
	
			<ifMode mode="ENTER">				
				$otherRows.hide(); //Hide all rows apart from first row if adding new form
				$firstRow.find('.remove').hide(); //Hide the remove button from the first row
			</ifMode>
			
			<ifMode mode="EDIT">
				//Handle loading of existing obs
				$allTables = jq('table.multi');
				$allTables.each(function() {
					$allRows = jq(this).find('tbody &gt; tr');
					$allRows.hide();
		        	$nonEmptyBoxes = jq(this).find('tbody tr input[type=text],tbody tr select').filter(function() {
		            	return this.value.length &gt; 0;
			        });

					if ($nonEmptyBoxes.length &gt; 0 ) {
					  $nonEmptyBoxes.each(function() {
						$thisRow = jq(this).parents('tr:first');
						$thisRow.show();
						if ($thisRow.is($firstRow)) {
							$firstRow.find('.remove').hide();
						}
					  });
					  
					  if ($nonEmptyBoxes.length == 1) {
						$nonEmptyBoxes.parents('tr:first').find('.remove').hide(); //Hide the remove button if there is only one visible row
					  }				  
					} else {
					  $firstRow.show();
					  $firstRow.find('.remove').hide();
					}
				});
			</ifMode>
	
			jq('.add').click(function(e) { //Handle add button event
				e.preventDefault();
				$thisRow = jq(this).parents('tr:first');
				$nextRow = $thisRow.next();
	
				if ($nextRow.length &gt; 0) {
					$nextRow.show('slow');
					$thisRow.find('.add').hide();
				}
				showAddButtonForLastVisibleRow($thisRow.parents('table:first'));
			});
			
			jq('.remove').click(function(e) { //Handle remove button event
				e.preventDefault();
				$thisRow = jq(this).parents('tr:first');
				if (confirm('Are you sure you want to remove this record? All fields for this record will be cleared.') == 1) {
					$thisRow = jq(this).parents('tr:first');
					$thisRow.hide('slow', function() {
						showAddButtonForLastVisibleRow($thisRow.parents('table:first'));
						fieldHelper.clearAllFields($thisRow);
					});
				}
			});

			// Disallow an entry from being selected twice in the autocomplete multiple entry sections 
			jq(".autoCompleteText").on( "autocompleteselect", function( event, ui ) {

				var $similarSelections = jq(this).parents('table:first').find('input.autoCompleteText:visible[type=text]').filter(function() {
					return (jq(this).val() == ui.item.label);
				});

				if ($similarSelections.length &gt; 0 ) {
					alert('The entry \'' + ui.item.label + '\' has already been selected');
					return false;
				} else {
					return true;
				}
			});

		});

	</script>
  <div class="ai-page-frame">
    <div class="headers" style="text-align: center;">
      <h3 style="background: #FFFF7D; padding: 10px;">HMIS 096A Health Unit TB Form</h3>
    </div>
    <fieldset>
    	<legend>Summary Information</legend>
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
			  <td>
			    <p>
			      <label>Unit TB No.</label>
			      <obs conceptId="304df0d0-afe4-4a61-a917-d684b100a65a" id="unit-tb-no" />
			    </p>
			  </td>
			  <td>
			    <p>
			      <label>HSD TB No.</label>
			      <obs conceptId="d1cda288-4853-4450-afbc-76bd4e65ea70" id="hsd-tb-no" />
			    </p>
			  </td>
			  <td>
			    <p>
			      <label>District TB No</label>
			      <obs conceptId="67e9ec2f-4c72-408b-8122-3706909d77ec" id="district-tb-no" />
			    </p>
			  </td>
			</tr>
			<tr>
				<td>
				    <p>
				      <label>Name of contact person</label>
				      <obs conceptId="163258AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
				    </p>					
				</td>
				<td>
				    <p>
				      <label>Contact phone nummber</label>
				      <obs conceptId="159635AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
				    </p>					
				</td>				
				<td>
					<p>
						<label>Relationship of contact person</label>
						<obs 	conceptId="dce138f8-30ab-102d-86b0-7a5022ba4115"
								answerConceptIds="
								dce17a7d-30ab-102d-86b0-7a5022ba4115,
								dce180a8-30ab-102d-86b0-7a5022ba4115,
								dce186ca-30ab-102d-86b0-7a5022ba4115,
								dd1df716-30ab-102d-86b0-7a5022ba4115,
								dd1e1d59-30ab-102d-86b0-7a5022ba4115,
								dd1e43f2-30ab-102d-86b0-7a5022ba4115,
								dd21e8b5-30ab-102d-86b0-7a5022ba4115,
								dd22614e-30ab-102d-86b0-7a5022ba4115,
								dd22b709-30ab-102d-86b0-7a5022ba4115,
								dd23c975-30ab-102d-86b0-7a5022ba4115,
								dcc374a5-30ab-102d-86b0-7a5022ba4115"
								answerLabels="Parent,Child,Aunt/Uncle,Niece/Nephew,Grandparent,Grandchild,Brother/Sister,Cousin,Not family,Spouse/Partner,Friend" />
					</p>
				</td>
			</tr>
			<tr>
			  <td valign="top">
			    <p>
			      <label>Is patient a Health worker?</label>
			      <obs 	conceptId="5619AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
			      		answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
			      		style="radio" id="health-worker" 
			      		class="horizontal-layout-options" required="true" />
			    </p>
			  </td>
			  <td>
			    <p>
			      <label>Cadre of health worker</label>
			      <obs conceptId="1783AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
			      		answerConceptIds="
			      		162592AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
			      		162591AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
			      		164831AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
			      		1577AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
			      		1578AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
			      		1555AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
			      		163557AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
			      		7835a772-4b7c-491e-be3b-feda81bf104e,
			      		5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
			      		answerLabels="Clinical officer,Doctor, Laboratory Personnel, Nurse, Midwife, Community Health Worker,Dispenser,Dentist,Other" 
			      		id="cadre-of-health-worker" />
			    </p>
			  </td>
			  <td>
			  </td>
			</tr>
			<tr>
				<td>
					<p id="encounter-date">
					  <label>Date treatment started</label>
						<encounterDate default="today" disallowMultipleEncountersOnDate="block" />
						<span class="hidden">
						<encounterLocation default="8ab22b55-9a17-4121-bf08-6134a9a2439f"
						                   order="8ab22b55-9a17-4121-bf08-6134a9a2439f" />
						<encounterProvider role="Provider" style="autocomplete" required="required" default="currentUser" />
						</span>
					</p>					
				</td>
				<td>
					<p>
					  <label>Regimen</label>
					  <obs conceptId="16fd7307-0b26-4c8b-afa3-8362baff4042" style="dropdown" 
					  		answerConceptIds="c25e5586-4660-4020-83cd-ee7f7f7fec20,b539f758-b24b-417f-9400-4edeca0f6e06,73cd1cda-e82a-43d8-938c-fbaf97b7642b,d250bcae-5889-4bb4-9903-e47f8594f746,7f47837f-1ea5-4a99-b4dd-5ca268d24ba8,eb1f1131-d0e2-414a-94a5-d5c7ad126c9f,5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
					  		answerLabels="2SRHZE/RHZE/5RHE,2RHZ/4RH,2RHZE/6EH,2RHZE/4H,2RHZE/10RH,2RHZE/4RH,OTHER" 
					  		showCommentField="True" commentFieldLabel="&lt;label&gt;Specify&lt;/label&gt;" class="has-comment" />
					</p>					
				</td>
				<td>
					<p>
					  <label>Disease classification</label>
					  <obs 	conceptId="d45871ee-62d6-4d4d-b905-f7b75a3fd3bb" 
					  		answerConceptIds="
					  		113491AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
					  		113489AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
					  		dca7ae44-30ab-102d-86b0-7a5022ba4115" 
					  		answerLabels="P-BC - Pulmonary bacteriologically confirmed TB treatment,P-CD - Pulmonary clinically diagnosed TB,EP - Extra pulmonary TB" 
					  		id="disease-classification" />
					</p>
				</td>
			</tr>
			<tr>
				<td>
					<p>
					  <label>Type of patient</label>
					  <obs 	conceptId="e077f196-c19a-417f-adc6-b175a3343bfd" 
					  		answerConceptIds="
					  		b3c43c5e-1987-42c1-a7b3-2c71dc58c126,
					  		8ad53c8c-e136-41e3-aab8-eace935a3bbe,
					  		7f5420a6-2c1a-4bb9-b6cf-8ed565933669,
					  		a37462b6-1f47-4efb-8df5-2bdc742efc17,
					  		1067AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
					  		answerLabels="N - New,R - Relapse,F - Failure,L - Lost to follow up,THU - Treatment history unknown" 
					  		required="true" />
					</p>
				</td>
				<td>
					<p>
					  <label>Transfer in from</label>
					  <obs conceptId="88e07e7c-f7e4-4ccf-8068-b770a3e3957b" id="transfer-in-from" />
					</p>
				</td>
				<td>
					<p id="transfer-in-unit-tb-no">
					  <label>Transfer in - Unit TB No.</label>
					  <patient 	field="identifier" 
					  			identifierTypeId="1d2be2a3-7d90-42a6-aasa5-a04b684a365b" 
					  			id="transfer-in-unit-tb-no" required="false" />
					</p>
				</td>
			</tr>
		</table>
    </fieldset>

	<fieldset>
		<legend>Pre-Rx Sputum Smear</legend>
		<table>
			<tr>
				<td>
		            <p>
		              <label>Sputum smear results</label>
		              <obs 	conceptId="dc74ab15-30ab-102d-86b0-7a5022ba4115" 
		              		answerConceptIds="dc9825cf-30ab-102d-86b0-7a5022ba4115,dc85aa72-30ab-102d-86b0-7a5022ba4115,9a1da4c4-8b3e-4abe-8973-81ed7f3be2fa,6a248b5a-e5f1-4b54-afaf-fbdce9e4d4d2,f7fb1ddc-c1cd-4f69-83fa-1e5ba5a7506b,c039361d-3bf7-47ac-81d0-4baaa62da73a,d9ef7712-ff3e-4106-aed2-59eb162531a0,068b6480-c6c1-4b07-ad21-2c7526713c91,3ff926cf-ce67-40da-b4d6-adc5fc08a073,e7724a60-58a6-4b99-aa5c-03a10393d5fd,39a9b825-a033-48cf-8b71-d2e0170dc6e0,389fd35a-5ce0-415f-b00b-096bf67880af,16e293b5-09eb-433d-a2d0-aa8ee33c7d51,681629aa-86f7-4efc-bce2-3ce589ca7fa1" 
		              		answerLabels="ND - Not Done ,NEG - 0AFB/100, 1 - 1AFB/100 ,2 - 2AFB/100 ,3 - 3AFB/100 ,4 - 4AFB/100 ,5 - 5AFB/100,6 - 6AFB/100,7 - 7AFB/100,8 - 8AFB/100,9 - 9AFB/100,+ - 10-99 AFB/100 Fields,++ - 1-10 AFB/Field,+++ - &gt;10AFB/Field" 
		              		class="sputum-smear-results" style="dropdown" />
		            </p>
				</td>
				<td>
					<p>
						<label>Sputum Smear Examination Date</label>
						<obs conceptId="e761b90d-8346-49b3-a754-5cfbd26ee43b" class="sputum-smear-results-date" />
					</p>
				</td>
			</tr>
		</table>				
	</fieldset>

	
	<fieldset>
		<legend>Results of Other Examinations</legend>
		<table>
			<tr>
				<td>
					<label>Mantoux</label>
					<obs 	conceptId="140144AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
							showDate="true" dateLabel="&lt;/td&gt;&lt;td&gt;&lt;label&gt;Mantoux Examination Date&lt;/label&gt;" />
				</td>
			</tr>
			<tr>
				<td>
					<label>GeneXpert</label>
					<obs 	conceptId="162202AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
							answerConceptIds="162204AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, 162203AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, 164104AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA, dc85aa72-30ab-102d-86b0-7a5022ba4115, 163611AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
							answerLabels="T - MTB Detected and Rifampicin resistance not detected),RR - MTB Detected and Rifampicin resistance detected,TI - MTB Detected and Rifampicin resistance indeterminate,N - MTB not detected,I - Invalid no result - error" 
							showDate="true" dateLabel="&lt;/td&gt;&lt;td&gt;&lt;label&gt;GeneXpert Examination Date&lt;/label&gt;" />
				</td>
			</tr>
			<tr>
				<td>
					<label>Biopsy</label>
					<obs 	conceptId="164907AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"								
							answerConceptIds="dc866728-30ab-102d-86b0-7a5022ba4115,dc85aa72-30ab-102d-86b0-7a5022ba4115" 
							answerLabels="AFBs Found, No AFBs Found" 
							showDate="true" dateLabel="&lt;/td&gt;&lt;td&gt;&lt;label&gt;Biopsy Examination Date&lt;/label&gt;" />
				</td>
			</tr>
			<tr>
				<td>
					<label>Cerebrospinal Fluid Examination (CSF)</label>
					<obs 	conceptId="159645AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
							answerConceptIds="dc866728-30ab-102d-86b0-7a5022ba4115,dc85aa72-30ab-102d-86b0-7a5022ba4115" 
							answerLabels="AFBs Found, No AFBs Found" 
							showDate="true" dateLabel="&lt;/td&gt;&lt;td&gt;&lt;label&gt;CSF Examination Date&lt;/label&gt;" />
				</td>
			</tr>
			<tr>
				<td>
					<label>X-ray results</label>
					<obs 	conceptId="12" 
							answerConceptId="dc9816bd-30ab-102d-86b0-7a5022ba4115"
							answerLabel="Normal" 
							class="horizontal-layout-options" />
					<obs 	conceptId="12" 
							answerConceptId="1137AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
							answerLabel="Miliary Changes" />
					<obs 	conceptId="12" 
							answerConceptId="dcad8a96-30ab-102d-86b0-7a5022ba4115" 
							answerLabel="Evidence Of Cardiac Enlargement" />
					<obs 	conceptId="12" 
							answerConceptId="dcd555fc-30ab-102d-86b0-7a5022ba4115" 
							answerLabel="Infiltrate" class="horizontal-layout-options" />
					<obs 	conceptId="12" 
							answerConceptId="dcd55c78-30ab-102d-86b0-7a5022ba4115" 
							answerLabel="Diffuse Non-Miliary Changes" />
					<obs 	conceptId="12" 
							answerConceptId="dcd5655d-30ab-102d-86b0-7a5022ba4115" 
							answerLabel="Cavitary Lesion" />
					<obs 	conceptId="12" 
							answerConceptId="114108AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
							answerLabel="Pleural Effusion" />
					<obs 	conceptId="12" 
							answerConceptId="5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
							answerLabel="Other&lt;/label&gt;&lt;label id='other-xray'&gt;&lt;/label&gt;" 							
							class="horizontal-layout-options has-comment" commentFieldLabel="&lt;span id='other-xray-comment'&gt;&lt;/span&gt;"/>
				</td>
				<td>
					<label>X-ray Examination Date</label>
					<obs conceptId="c56ddd82-a49f-481d-9a17-70e273b7ce86" />
				</td>
			</tr>
		</table>
	</fieldset>

    <fieldset>
      <legend>Sputum smear follow up and DST results</legend>
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="multi novalidate" >
      	<tbody>
		  <repeat>
	      	<template>
				<obsgroup groupingConceptId="9deeba77-cc1b-47ef-b4ab-84b22fb527f3">
			        <tr>
						<td>
				            <p>
				              <label>Sputum smear results</label>
				              <obs 	conceptId="307" 
				              		answerConceptIds="1118,664,164422,164423,164424,164425,164426,164427,164428,164429,164430,99388,99389,99390" 
				              		answerLabels="ND - Not Done ,NEG - 0AFB/100, 1 - 1AFB/100 ,2 - 2AFB/100 ,3 - 3AFB/100 ,4 - 4AFB/100 ,5 - 5AFB/100,6 - 6AFB/100,7 - 7AFB/100,8 - 8AFB/100,9 - 9AFB/100,+ - 10-99AFB/Field,++ - 1-10AFB/Field,+++ - &gt;10AFB/Field" 
				              		class="sputum-smear-results" style="dropdown" />
				            </p>
						</td>
						<td>
							<p>
								<label>Sputum Smear Examination Date</label>
								<obs conceptId="99392" class="sputum-smear-results-date" />
							</p>
						</td>
						<td>
							<p>
							  <label>Drug Susceptibility Testing (DST) Results</label>
							  <obs 	conceptId="159984AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
							  		answerConceptIds="164366,164432,159345,664,164367,159346" 
							  		answerLabels="1 - Rif Monoresistant,2- INH Monoresistant,3 - MDR Confirmed,4 - Polyresistant,5 - Pan Sensitive, 6- XDR Confirmed" 
							  		style="dropdown" class="dst-results" />
							</p>
						</td>
						<td>
							<p>
							  <label>Date of DST results</label>
							  <obs conceptId="164396" class="dst-results-date" />
							</p>
						</td>
						<td align="center">
							<a href="#" class="add">Add</a> | <a href="#" class="remove">Remove</a>
						</td>
			        </tr>
			        </obsgroup>
	        </template>
	        <render />
	        <render />
	        <render />
	        <render />
	        <render />
	        <render />
	      </repeat>
	     </tbody>
      </table>
    </fieldset>

    <fieldset>
      <legend>TB/HIV Activities</legend>
      <table width="100%" border="0" cellspacing="0" cellpadding="0" id="tb-hiv-activities">
        <tr>
          <td valign="top">
            <p>
              <label>HIV Counselling and testing</label>
              <obs 	conceptId="4395c8b9-2aaa-46b2-a228-5968e42bf085" 
              		answerConceptIds="bcbbaa2d-18c1-4292-91ac-67bf2069417b,17302d1a-e24c-4343-a071-6170d49a163c,c4f1f27e-e0c1-4004-8251-a00164ce30ef,88eade2c-e74e-4c16-9286-43916419adf6" 
              		answerLabels="C - Counselling done, CT - Counselling and testing done, CT1 - Counselling and testing done for HIV Positive, CT2 - Counselling and testing done for HIV Negative"
              		style="dropdown" id="hiv-counselling-and-testing" />
            </p>
          </td>
          <td valign="top">
            <p>
              <label>HIV Testing Date</label>
              <obs conceptId="164400AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="hiv-testing-date" />
            </p>
          </td>
          <td valign="top">
            <p>
              <label>
                Patient received HIV Results?
              </label>
              <obs 	conceptId="ad2884a2-830f-4ca8-bc1e-1e1fd2df0f81" style="radio" 
              		answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Yes, No"
              		class="horizontal-layout-options" id="patient-received-hiv-results" />
            </p>
          </td>
          <td valign="top">
            <p>
              <label>
                HIV Test Results?
              </label>
              <obs 	conceptId="3d292447-d7df-417f-8a71-e53e869ec89d" style="radio" 
              		answerConceptIds="dcdf4241-30ab-102d-86b0-7a5022ba4115,dcdf4653-30ab-102d-86b0-7a5022ba4115,16d4ad2b-c4eb-4e88-a27f-5d9b9b6a9aed" 
              		answerLabels="HIV+,HIV-,Inconclusive"
              		class="horizontal-layout-options" id="patient-hiv-results" />
            </p>
          </td>
        </tr>
        <tr>
          <td valign="top">
            <p>
              <label>
                Is patient On CPT?
              </label>
              <obs 	conceptId="160434AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
              		answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
              		answerLabels="Yes,No" id="on-cpt" style="radio" 
              		class="horizontal-layout-options"/>
            </p>
          </td>
          <td valign="top">
            <p>
              <label>CPT Start Date</label>
              <obs conceptId="164361AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="cpt-start-date" />
            </p>
          </td>
          <td>
            <p>
              <label>Is patient On ART?</label>
              <obs 	conceptId="159991AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
              		answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerLabels="Yes,No" id="on-art" style="radio" 
              		class="horizontal-layout-options"/>
            </p>
          </td>
          <td>
            <p>
              <label>ART Start Date</label>
              <obs 	conceptId="ab505422-26d9-41f1-a079-c3d222000440" 
              		allowFutureDates="false" id="art-start-date" />
            </p>
          </td>
      </tr>
      <tr>
          <td>
            <p>
              <label>ART No</label>
              <obs 	conceptId="105ef9de-ad90-4c08-bcd5-ab48f74f6287" id="art-number" />
            </p>
          </td>
          <td colspan="3"></td>
        </tr>
      </table>
    </fieldset>

    <fieldset>
      <legend>Contact with children under 5 years</legend>
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td valign="top">
            <p>
              <label>No. of children &lt;5yrs in contact</label>
              <obs 	conceptId="164419AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="no-of-children-in-contact" />
            </p>
          </td>
          <td>
            <p>
              <label>No. of children &lt; 5yrs on IPT</label>
              <obs 	conceptId="164421AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="no-of-children-in-contact-on-ipt" />
            </p>
          </td>
        </tr>
      </table>
    </fieldset>

    <fieldset>
      <legend>Treatment model</legend>
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td valign="top">
            <p>
              <label>Treatment Model (DOTS)</label>
              <obs 	conceptId="c7858e35-20d1-4503-908c-7b8bd8b8b376" answerConceptIds="ecb88326-0a3f-44a5-9bbf-df4bfc3239e1,e646fcf7-aaf2-4b04-a24c-9b4506bf634f" 
              		answerLabels="F - Facility COTS, C - Community COTS (CBDOTS)" style="radio"
              		class="vertical-layout-options" />
            </p>
          </td>
          <td>
            <p>
              <label>DOTS Date</label>
              <obs 	conceptId="dce02eca-30ab-102d-86b0-7a5022ba4115" 
              		allowFutureDates="false" />
            </p>
          </td>
          <td>
            <p>
              <label>Name of treatment supporter</label>
              <obs conceptId="23e28311-3c17-4137-8eee-69860621b80b" />
            </p>
          </td>
          <td>
            <p>
              <label>Telephone Contact of treatment supporter</label>
              <obs conceptId="dce17480-30ab-102d-86b0-7a5022ba4115" />
            </p>
          </td>
        </tr>
      </table>
    </fieldset>

    <fieldset>
      <legend>Issue of anti-TB drug</legend>
      <table width="100%" border="0" cellspacing="0" cellpadding="0" style="width:100%" id="drugs" class="multi" >
        <thead>
          <tr>
            <th style="width:20%">  
            	<p>
            		<label>TB Treatment phase</label>
            	</p>    
            </th>
            <th style="width:40%">
              	<p>
                	<label>Name of drug</label>
              	</p>
            </th>
            <th>
            	<p>
            		<label>Date Issued</label>
            	</p>
            </th>
            <th style="width:20%">
              	<p>
              		<label>Duration of treatment</label>
              	</p>
            </th>
            <th align="center" style="width:10%"></th>
          </tr>
        </thead>
        <tbody>
          <repeat>
            <template>
              <obsgroup groupingConceptId="163711">
                <tr>
                  <td>
                    <p>
                      <obs 	conceptId="159792" 
                      		answerConceptIds="159794,159795" 
                      		answerLabels="Intensive Phase, Continous Phase" 
                      		style="radio" class="vertical-layout-options" />
                    </p>
                  </td>
                  <td>
	                  <obs 	conceptId="dc9b5b8f-30ab-102d-86b0-7a5022ba4115" 
	                  		answerConceptIds="1675,1678" 
	                  		answerLabels="RHZE,RH"
	                  		style="dropdown" showDate="True" dateLabel="&lt;/td&gt;&lt;td&gt;" />
                  </td>
                  <td class="duration">
                    <p>
                      <obs conceptId="159368"/>
                      <obs conceptId="1732" answerConceptIds="1072,1073,1074" />
                    </p>
                  </td>
                  <td align="center">
                    <a href="#" class="add">Add</a> | <a href="#" class="remove">Remove</a>
                  </td>
                </tr>
              </obsgroup>
            </template>
            <render />
            <render />
            <render />
            <render />
            <render />
            <render />
            <render />
            <render />
            <render />
            <render />
          </repeat>
        </tbody>
      </table>
    </fieldset>

    <fieldset>
      <legend>Treatment outcome and date when outcome determined</legend>
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <p>
              	<label>Treatment Outcome</label>
              	<obs 	conceptId="e44c8c4c-db50-4d1e-9d6e-092d3b31cfd6" 
              			answerConceptIds="159791AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,dd27a783-30ab-102d-86b0-7a5022ba4115,159874AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,dca27d22-30ab-102d-86b0-7a5022ba4115,dcb23465-30ab-102d-86b0-7a5022ba4115,160737AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
              			answerLabels="Cured,Transferred out,Treatment failure,Died,Lost to follow up, Not evaluated" 
              			style="dropdown" id="treatment-outcome" />
            </p>
          </td>
          <td>
            <p>
              	<label>Date when outcome determined</label>
              	<obs conceptId="159787AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" />
            </p>
          </td>
          <td>
            <p>
              	<label>Transfer out to (Name of unit)</label>
              	<obs conceptId="dce015bb-30ab-102d-86b0-7a5022ba4115" id="transfer-out-to" />
            </p>
          </td>
          <td>
          	<p>
          		<label>Diagnosed with Drug Resistant TB</label>
          		<obs 	conceptId="160039AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
          				answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" 
          				answerLabels="Yes,No" 
          				style="radio" class="horizontal-layout-options"/>
          	</p>
          </td>
        </tr>
        <tr>
          <td colspan="4">
            <p>
              <label>Remarks</label>
              <obs conceptId="159395AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="textarea" />
            </p>
          </td>
        </tr>
      </table>
    </fieldset>

    <postSubmissionAction class="org.openmrs.module.aijar.htmlformentry.TBProgramPostSubmissionAction" />
    <section>
        <submit/>
        <span style="clear:none;float:none;margin:5px;display: none;"
              class="error1" id="error-message">
            You have errors in your form, please scroll up to see them.
        </span>
    </section>
  </div>
</htmlform>
