<htmlform formName="Patient Transfers"
          formDescription=""
          formUuid="45d9db68-e4b5-11e7-80c1-9a214cf093ae"
          formVersion="1.0"
          formAddMetadata="yes"
          formUILocation="patientDashboard.overallActions"
          formOrder="1"
          formIcon="icon-exchange"
          formShowIf="patient.person.dead==false"
          formDisplayStyle="Standard"
          formLabel="Patient Referral">
    <style>

        form label, .form label {
            float: left;
            padding: 0px 10px 0 0;
        }

        form input[type="checkbox"], form input[type="radio"], .form input[type="checkbox"], .form input[type="radio"] {
            margin: 10px 15px;
        }

        table td {
            background: #FFFFFF;
            color: #404040;
        }

        form select, .form select {
            min-width: 0px;
        }

        form input, form select, form textarea, form ul.select, .form input, .form select, .form textarea, .form
        ul.select {
            background-color: #FBFBFB;
            border: 1px solid #CEC9C9;
            border-radius: 5px;
            margin-bottom: 10px;
            padding: 10px;
            min-width: 20%;
        }

        .row {
            width: 100%;
            float: left;
            display: inline-flex;
            clear: both;
        }

        .results_style {
            font-weight: bold;
            color: #0808fd;
        }

        .row .row-col2 {
            float: left;
            width: 50%;
        }

        table th, table td {
            border: 1px solid #AFAFAF;
        }
    </style>
    <script type="text/javascript">
        if (jQuery) {
            jq(document).ready(function () {

                var data1 = jq.ajax({
                    dataType: "json",
                    url: "http://localhost:8080/openmrs/ws/rest/v1/encounter?patient=990d60c5-1966-45b0-9222-3322f7a59317&amp;v=custom%3A(display%2Cobs%3A(concept%3A(conceptId)%2CvalueText%2CvalueNumeric%2CvalueDatetime%2CvalueCoded%3A(conceptId)))&amp;encounterType=8d5b27bc-c2cc-11de-8d13-0010c6dffd0f&amp;limit=1",
                    data: "",
                    success: "success"
                });

                var data2 = jq.ajax({
                    dataType: "json",
                    url: "http://localhost:8080/openmrs/ws/rest/v1/encounter?patient=990d60c5-1966-45b0-9222-3322f7a59317&amp;v=custom%3A(display%2Cobs%3A(concept%3A(conceptId)%2CvalueText%2CvalueNumeric%2CvalueDatetime%2CvalueCoded%3A(conceptId)))&amp;encounterType=8d5b2be0-c2cc-11de-8d13-0010c6dffd0ff&amp;limit=1",
                    data: "",
                    success: "success"
                });

                // Enable disable other outcomes
                jq('#encounter_type').change(function () {
                    enable_disable('encounter_type', '99109', 'TRANSFER IN');
                });

                jq('#encounter_type').each(function () {
                    enable_disable('encounter_type', '99109', 'TRANSFER IN');
                });

                jq('#encounter_type').change(function () {
                    enable_disable('encounter_type', 'transfer_in', 'TRANSFER IN');
                });

                jq('#encounter_type').each(function () {
                    enable_disable('encounter_type', 'transfer_in', 'TRANSFER IN');
                });

                jq('#encounter_type').change(function () {
                    enable_disable('encounter_type', 'transfer_out', 'TRANSFER OUT');
                });

                jq('#encounter_type').each(function () {
                    enable_disable('encounter_type', 'transfer_out', 'TRANSFER OUT');
                });

                // Enable disable other outcomes
                jq('#encounter_type').change(function () {
                    enable_disable('encounter_type', '90211', 'TRANSFER OUT');
                });

                jq('#encounter_type').each(function () {
                    enable_disable('encounter_type', '90211', 'TRANSFER OUT');
                });


                jq('#164993').change(function () {
                    enable_disable('164993', 'comprehensive_transfer', 'ART Clinic');
                });

                jq('#164993').each(function () {
                    enable_disable('164993', 'comprehensive_transfer', 'ART Clinic');
                });

            });

            function enable_disable(triggerId, enabledDisabledId, conditionValue) {
                if (jq("#" + triggerId + " :selected").text() == conditionValue) {
                    showContainer('#' + enabledDisabledId);
                } else if (jq('#' + triggerId).find('span').text() == conditionValue) {
                    showContainer('#' + enabledDisabledId);
                } else {
                    hideContainer('#' + enabledDisabledId);
                }
            }
        }
    </script>
    <div class="ai-page-frame">
        <div class="headers" style="text-align: center;">
            <h3 style="background: #94979A; padding: 10px;">Patient Transfer/Referral Form (Transfer in
                Transfer out)</h3>
        </div>
        <section>
            <table>
                <tbody>
                <tr>
                    <td>
                        <label>Referral Type:</label>
                        <br/>
                        <encounterType id="encounter_type"
                                       types="3e8354f7-31b3-4862-a52e-ff41a1ee60af,e305d98a-d6a2-45ba-ba2a-682b497ce27c"
                                       default="Select Referral Type"/>
                    </td>
                    <td>
                        Date:
                        <encounterDate default="today" disallowMultipleEncountersOnDate="block"/>
                        <span style="display: none;">
                                            <encounterLocation default="629d78e9-93e5-43b0-ad8a-48313fd99117"
                                                               order="629d78e9-93e5-43b0-ad8a-48313fd99117"/>
                                        </span>
                    </td>
                    <td id="99109">
                        <obs conceptId="99109" labelText=" From Where"/>
                    </td>
                    <td id="90211">
                        <obs conceptId="90211" labelText=" To Where"/>
                    </td>
                    <td>
                        <label>Clinic Referred to:</label>
                        <br/>
                        <obs id="164993" conceptId="164993" answerConceptIds="90013,90014,165048,90018,165047,99610"
                             answerLabels="OPD Clinic,PED OPD Clinic,TB Clinic,IPD,ART Clinic,SMC Care"/>
                    </td>
                </tr>

                </tbody>
            </table>
        </section>

        <div id="comprehensive_transfer">
            <div class="ai-page-frame" id="transfer_in">
                <div class="headers" style="text-align: center;">
                    <h3>Comprehensive HIV Care/ART Patient Referral/Transfer</h3>
                </div>
                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>Patient ART History</th>
                            <th>Baseline Lab (At Start of ART)</th>
                            <th>Baseline Clinic Stage</th>
                        </tr>
                        <tr>
                            <td>
                        <span class="ArtCareEnableDisable1">
                            <obs id="99061" conceptId="99061"
                                 answerConceptIds="99005,99006,99015,99016,99039,99040,99041,99042,99884,99885,163017,99143"
                                 answerLabels="AZT-3TC-NVP, AZT-3TC-EFV, D4T-3TC-NVP, D4T-3TC-EFV, TDF-3TC-NVP, TDF-3TC-EFV, TDF-FTC-NVP, TDF-FTC-EFV,ABC-3TC-NVP,ABC-3TC-EFV,ABC-3TC-LPV/r,OTHER"
                                 labelText="Initial Regimen"/>
                                </span>
                                <span class="ArtCareEnableDisableChild1">
                                <obs id="99268" conceptId="99268" labelText="Others"/>
                            </span>

                                <p>
                                    <obs id="99161" conceptId="99161" labelText="Date started:"/>
                                </p>
                            </td>
                            <td>

                                <obs id="163029" conceptId="163029" labelText="Viral Load"/>
                                <br/>
                                <obs id="163028" conceptId="163028" labelText="HB"/>
                                <br/>

                                <obs id="99071" conceptId="99071" labelText="CD4"/>
                                <br/>
                                <obs id="99145" conceptId="99145" labelText="CD4 (%)"/>
                                <br/>
                                <obs id="163024" conceptId="163024" labelText="TLC"/>

                            </td>
                            <td>
                                <obs id="99069" conceptId="99069" labelText="Weight"/>
                                <br/>
                                <obs id="163025" conceptId="163025" labelText="Height (Children)"/>
                                <br/>
                                <obs id="163026" conceptId="163026" labelText="WHO Clinic Status"/>
                                <br/>
                                <obs id="163027" conceptId="163027" labelText="Functional Status"/>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>

                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>Current Regiment</th>
                            <th>Most Recent Lab(Date done)</th>
                            <th>Current Clinic Stage</th>
                        </tr>
                        <tr>
                            <td>
                        <span class="ArtCareEnableDisable2">
                            <obs id="90315" conceptId="90315"
                                 answerConceptIds="99005,99006,99015,99016,99039,99040,99041,99042,99884,99885,163017,99143"
                                 answerLabels="AZT-3TC-NVP, AZT-3TC-EFV, D4T-3TC-NVP, D4T-3TC-EFV, TDF-3TC-NVP, TDF-3TC-EFV, TDF-FTC-NVP, TDF-FTC-EFV,ABC-3TC-NVP,ABC-3TC-EFV,ABC-3TC-LPV/r,OTHER"
                                 labelText="Initial Regimen"/>
                                </span>
                                <span class="ArtCareEnableDisableChild2">
                                <obs id="99126" conceptId="99126" labelText="Others"/>
                            </span>

                                <p>
                                    <obs id="163030" conceptId="163030" labelText="Regiment Issued till"/>
                                </p>
                            </td>
                            <td>
                                <obs id="856" conceptId="856" labelText="Viral Load"/>
                                <br/>
                                <obs id="21" conceptId="21" labelText="HB"/>
                                <br/>

                                <obs id="5497" conceptId="5497" labelText="CD4"/>
                                <br/>
                                <obs id="730" conceptId="730" labelText="CD4 (%)"/>
                                <br/>
                                <obs id="1021" conceptId="1021" labelText="TLC"/>

                            </td>
                            <td>
                                <obs id="5089" conceptId="5089" labelText="Weight"/>
                                <br/>
                                <obs id="5090" conceptId="5090" labelText="Height (Children)"/>
                                <br/>
                                <obs id="90203" conceptId="90203" labelText="WHO Clinic Status"/>
                                <br/>
                                <obs id="90235" conceptId="90235" labelText="Functional Status"/>

                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>

                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>TB Status</th>
                            <th>Other Opportunist Infections<br/> and Medications</th>
                            <th>Pregnancy Status</th>
                        </tr>
                        <tr>
                            <td>
                        <span class="DistrictTbRegEnableDisable1">
                                <obs id="90216" conceptId="90216" labelText="Tb Status"
                                     answerConceptIds="90079,90073,90078,90071"
                                     answerLabels="No signs,Suspect,Diagnosed with Tb,Tb Rx"/>
                            </span>
                                <span class="DistrictTbRegEnableDisableChild1">
                                <obs id="90217" conceptId="90217" labelText="TB Start Date:"/>
                            </span>
                            </td>

                            <td>
                                <obs id="99032" conceptId="99032" labelText="Other Opportunist Infections"/>

                                <obs id="99032" conceptId="99032" labelText="Other Medications"/>
                            </td>
                            <td>
                                <excludeIf velocityTest="$patient.gender =='M' || $patient.age &lt; 9">
                                <span class="PregnantEnableDisable1">
                                    <obs id="90041" conceptId="90041" style="checkbox" answerConceptIds="1066,1065"
                                         answerLabels="Yes,No" labelText="Pregnant"/>
                                </span>
                                    <span class="PregnantEnableDisableChild1">
                                    <obs id="5596" conceptId="5596" labelText="EDD" allowFutureDates="true"/>
                                    <br/>
                                </span>
                                </excludeIf>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <label>Any Drug Allergies</label>
                                <obs id="142" conceptId="142" size="30" style="textarea" rows="5" cols="80"/>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <label>Reasons For Transfer</label>
                                <obs id="99387" conceptId="99387" size="30" style="textarea" rows="5" cols="80"/>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>
            </div>


            <div class="ai-page-frame" id="transfer_out">
                <div class="headers" style="text-align: center;">
                    <h3>Comprehensive HIV Care/ART Patient Referral/Transfer</h3>
                </div>
                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>Patient ART History</th>
                            <th>Baseline Lab (At Start of ART)</th>
                            <th>Baseline Clinic Stage</th>
                        </tr>
                        <tr>
                            <td>
                                <div style="width: 100%">
                                    <label>Regimen:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99061').valueCoded.name"/>
                                </div>
                                <div style="width: 100%">
                                    <label>Other Regimen:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99268').valueText"/>
                                </div>
                                <br/>

                                <div style="width: 100%">
                                    <label>Date started:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99161').valueDatetime"/>
                                </div>
                            </td>
                            <td>

                                <div style="width: 100%" class="lookup">
                                    <label>Viral Load:</label>
                                    <lookup class="results_style" expression="fn.latestObs('163029').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>HB:</label>
                                    <lookup class="results_style" expression="fn.latestObs('163028').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>CD4:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99071').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>CD4 (%):</label>
                                    <lookup class="results_style" expression="fn.latestObs('99145').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>TLC:</label>
                                    <lookup class="results_style" expression="fn.latestObs('163024').valueNumeric"/>
                                </div>
                            </td>
                            <td>
                                <div style="width: 100%">
                                    <label>Weight:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99069').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>Height:</label>
                                    <lookup class="results_style" expression="fn.latestObs('163025').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>WHO Clinic Status:</label>
                                    <lookup class="results_style" expression="fn.latestObs('99070').valueCoded.name"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>Functional Status:</label>
                                    <lookup class="results_style" expression="fn.latestObs('163027').valueCoded.name"/>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>

                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>Current Regiment</th>
                            <th>Most Recent Lab(Date done)</th>
                            <th>Current Clinic Stage</th>
                        </tr>
                        <tr>
                            <td>
                                <div style="width: 100%">
                                    <label>Regimen:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90315').valueCoded.name"/>
                                    <lookup class="results_style" expression="fn.latestObs('99126').valueText"/>
                                </div>
                                <div style="width: 100%">
                                    <label>Regiment Issued until:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90315').dateCreated"/>
                                    <lookup class="results_style" expression="fn.latestObs('99126').dateCreated"/>
                                </div>
                            </td>
                            <td>
                                <div style="width: 100%" class="lookup">
                                    <label>Viral Load:</label>
                                    <lookup class="results_style" expression="fn.latestObs('1305').valueCoded.name"/>
                                    <lookup class="results_style" expression="fn.latestObs('856').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>HB:</label>
                                    <lookup class="results_style" expression="fn.latestObs('21').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>CD4:</label>
                                    <lookup class="results_style" expression="fn.latestObs('5497').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>CD4 (%):</label>
                                    <lookup class="results_style" expression="fn.latestObs('730').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%" class="lookup">
                                    <label>TLC:</label>
                                    <lookup class="results_style" expression="fn.latestObs('1021').valueNumeric"/>
                                </div>
                            </td>
                            <td>

                                <div style="width: 100%">
                                    <label>Weight:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90236').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>Height:</label>
                                    <lookup class="results_style" expression="fn.latestObs('5090').valueNumeric"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>WHO Clinic Status:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90203').valueCoded.name"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>Functional Status:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90235').valueCoded.name"/>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>

                <section>
                    <table class="enrollment">
                        <tbody>
                        <tr>
                            <th>TB Status</th>
                            <th>Other Opportunist Infections<br/> and Medications</th>
                            <th>Pregnancy Status</th>
                        </tr>
                        <tr>

                            <td>
                                <div style="width: 100%">
                                    <label>TB Status:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90216').valueCoded.name"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>TB Start Date:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90217').valueDatetime"/>
                                </div>
                                <br/>
                            </td>

                            <td>
                                <div style="width: 100%">
                                    <label>Other Opportunist Infections:</label>
                                    <lookup class="results_style" expression="fn.latestObs('90251').valueCoded.name"/>
                                    <lookup class="results_style" expression="fn.latestObs('99032').valueText"/>
                                </div>
                                <br/>
                                <div style="width: 100%">
                                    <label>Other Medications:</label>
                                    <lookup class="results_style" expression="fn.latestObs('1193').valueCoded.name"/>
                                    <lookup class="results_style" expression="fn.latestObs('99035').valueText"/>
                                </div>
                            </td>
                            <td>
                                <excludeIf velocityTest="$patient.gender =='M' || $patient.age &lt; 9">
                                    <div style="width: 100%">
                                        <label>Pregnant:</label>
                                        <lookup class="results_style"
                                                expression="fn.latestObs('90041').valueCoded.name"/>
                                    </div>

                                    <div style="width: 100%">
                                        <label>EDD:</label>
                                        <lookup class="results_style" expression="fn.latestObs('5596').valueDatetime"/>
                                        <br/>
                                    </div>
                                </excludeIf>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <label>Any Drug Allergies</label>
                                <div style="width: 100%">
                                    <label>Other Medications:</label>
                                    <lookup class="results_style"
                                            complexExpression="#foreach($allergy in $fn.allObs(142)) $allergy.valueText #end"/>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <label>Reasons For Transfer</label>
                                <obs conceptId="99387" size="30" style="textarea" rows="5" cols="80"/>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>
            </div>
        </div>
        <br/>
        <submit submitLabel="Save"/>
    </div>
</htmlform>